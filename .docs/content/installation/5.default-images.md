<!-- Title: Default container images and tags used by Terraform deployments -->

# Default images

This document explains how ArmoniK's Terraform-based quick-deploy system determines container image names and tags when those values are omitted from your `tfvars` files. The goal is to give you flexibility: you can rely on well-tested project defaults for most deployments, or override any image name and/or tag when you need a specific image or version.

## How defaults are resolved

- If you omit an image name in a `tfvars` block, Terraform will use the default image name declared in the appropriate `variables.tf` for that quick-deploy scenario (for example, the localhost quick-deploy variables file).
- If you omit an image tag, the system selects a default tag for that image from the central `versions.tfvars.json` file.

Defaults are organized in `versions.tfvars.json` as two related sets of values:

- `armonik_versions`: the canonical versions of ArmoniK components (for example: `core`, `extcsharp`, etc.).
- `armonik_images`: lists of image names produced by each ArmoniK component. The default tag used for those images corresponds to the component version listed in `armonik_versions`.

Third-party and external images have their default tags defined under the `image_tags` section of the same `versions.tfvars.json` file.

Important rule: you may override any image name and/or tag in your `tfvars`. However, if you provide an image name that is not present in `versions.tfvars.json`, you must also supply an explicit tag for that custom image so the deployment is fully deterministic.

## Examples (all-in-one local deployment)

The examples below use the all-in-one local deployment that includes a MongoDB instance. The `versions.tfvars.json` used in these examples contains entries similar to the following (truncated for readability):

```json
{
  "armonik_versions": {
    "core": "0.8.3",
    "extcsharp": "0.8.1"
  },
  "armonik_images": {
    "core": [
      "dockerhubaneo/armonik_control",
      "dockerhubaneo/armonik_core_bench_test_worker"
    ],
    "extcsharp": [
      "dockerhubaneo/armonik_worker_dll"
    ]
  },
  "image_tags": {
    "mongo": "5.0.9"
  }
}
```

You can also specify images and tags directly in a `tfvars` file (for example, `parameters.tfvars` in an AWS quick-deploy). The following examples show common patterns.

### Use the default image and default tag

When you leave a component block empty, both the image name and tag are selected from the defaults:

```terraform
mongodb = {}

control_plane = {
  default_partition = ...
}
```

Resulting images used by the deployment (examples):

- mongodb → `mongo:5.0.9` (from `image_tags`)
- control_plane → `dockerhubaneo/armonik_control:0.8.3` (image from `armonik_images` and tag from `armonik_versions`)

### Use the default image with a custom tag

You can request a different tag while keeping the project's default image name:

```terraform
mongodb = {
  image_tag = "6.0"
}

control_plane = {
  image_tag = "0.8.0"
  default_partition = ...
}
```

- mongodb → `mongo:6.0` (custom tag)
- control_plane → `dockerhubaneo/armonik_control:0.8.0` (custom tag)

### Use a custom image (explicit name and tag)

To use an image hosted in a different registry or with a different repository name, provide both the image name and a tag. When the image name is not part of the project's `versions.tfvars.json`, the tag is mandatory.

```terraform
mongodb = {
  image_name = "custom_registry/mongo"
  image_tag  = "6.0"
}

control_plane = {
  image_name = "custom_registry/custom_armonik_control"
  image_tag  = "0.8.3"
  default_partition = ...
}
```

- mongodb → `custom_registry/mongo:6.0`
- control_plane → `custom_registry/custom_armonik_control:0.8.3`

### Special rules for worker images

Worker images are handled slightly differently:

- There is no single global default worker image; worker images are listed under `armonik_images` and their default tags are derived from the corresponding component version in `armonik_versions`.
- If a worker image is present in `versions.tfvars.json`, you may omit the tag and the deployment will use the default tag from `image_tags` or from the related `armonik_versions` mapping.
- If you reference a worker image that is not in `versions.tfvars.json`, you must provide an explicit tag.

Example `compute_plane` snippet showing several worker configurations:

```terraform
compute_plane = {
  partition1 = { worker = [{ image = "dockerhubaneo/armonik_core_bench_test_worker" }] }
  partition2 = { worker = [{ image = "dockerhubaneo/armonik_worker_dll" }] }
  partition3 = { worker = [{ image = "dockerhubaneo/armonik_worker_dll" , tag = "0.8.0" }] }
  partition4 = { worker = [{ image = "custom_worker", tag = "0.1.0" }] }
}
```

Resulting worker images (examples):

- partition1 → `dockerhubaneo/armonik_core_bench_test_worker:0.8.3`
- partition2 → `dockerhubaneo/armonik_worker_dll:0.8.1`
- partition3 → `dockerhubaneo/armonik_worker_dll:0.8.0` (explicit tag)
- partition4 → `custom_worker:0.1.0` (custom image + explicit tag)

# Container Registry

TODO!