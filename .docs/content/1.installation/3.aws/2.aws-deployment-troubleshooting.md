# AWS Deployment Troubleshooting Guide üõ†Ô∏è

This guide covers common issues you might encounter while deploying your application on AWS and provides solutions to address them.

## 1. Error: Partition Not Found

If you encounter a Partition Not Found error during deployment or runtime, ensure the following:

- Set the Replication Factor to 1 in the [`parameters.tfvars`](https://github.com/aneoconsulting/ArmoniK/blob/main/infrastructure/quick-deploy/aws/parameters.tfvars):

```hcl
default = {
    node_selector = { service = "workers" }
    replicas = 1 # HERE
}
```

- Check Spelling in Configuration Files.
- Double-check for any typos in partition names or configurations. Even minor spelling mistakes can cause the error.

For example in [`parameters.tfvars`](https://github.com/aneoconsulting/ArmoniK/blob/main/infrastructure/quick-deploy/aws/parameters.tfvars):

```hcl
default = {
    node_selector = { service = "workers" }   
    replicas = 1 # HERE
```

instead of

```hcl
defautl = {
    node_selector = { service = "workers" }   
    replicas = 1 # HERE

```

## 2. Error: Incorrect URL or Missing Endpoint

If your application fails to connect to a service, verify the following:

### Use the Correct URL Generated by AWS

After deploying your application or service, AWS typically generates a URL for the *control_plane* or other services. Make sure to:

- Copy the URL provided by AWS during deployment.
- Update the client configuration with the correct endpoint before building your project.

Ensure the endpoint is properly defined in your client application, as shown below:

```csharp
var endpoint = new Option<string>("--endpoint",
                                  description: "Endpoint pour la connexion au control plane ArmoniK.",
                                  getDefaultValue: () => "http://localhost:5001");

```

### Adapting the URL When Using Docker

When running your application in a Docker container, remember to update the endpoint dynamically. For instance:

```bash
docker run --rm --name <container name> client --endpoint "http://<ip>:5001" --partition <partition name>
```

- Replace <ip> with the actual IP or hostname of the deployed service.
- Replace <partition_name> with the appropriate partition name you‚Äôre using.
- Always double-check that the endpoint and partition names are spelled correctly to avoid runtime errors.

## 3. Missing Images

If you encounter an error related to the Docker image not being found or incorrectly configured, follow these steps to ensure the image is built and referenced correctly.

### Ensure the Worker Image is Built Correctly

You need to build the Docker image for the worker using the following command:

```bash
docker build -f "./csharp/native/LinearSubTasking/Worker/Dockerfile" -t subtasking "./csharp/native/"
```

- **-f**: Specifies the path to the Dockerfile for your worker.
- **-t subtasking**: Tags the image as subtasking, which will be used as the image name.
- **"./csharp/native/"**: Specifies the context for the build (i.e., the root directory containing your source files).

Voici la documentation mise √† jour pour inclure la gestion des erreurs li√©es aux images Docker :
3. Error: Docker Image Not Found

If you encounter an error related to the Docker image not being found or incorrectly configured, follow these steps to ensure the image is built and referenced correctly.

Ensure the Worker Image is Built Correctly

You need to build the Docker image for the worker using the following command:

```bash
docker build -f "./csharp/native/LinearSubTasking/Worker/Dockerfile" -t subtasking "./csharp/native/"
```

- **-f**: Specifies the path to the Dockerfile for your worker.
- **-t subtasking**: Tags the image as subtasking, which will be used as the image name.
- **"./csharp/native/"**: Specifies the context for the build (i.e., the root directory containing your source files).

### Verify the Image Tag Matches the Configuration

The image name (**subtasking** in this case) must match the value specified in your Terraform parameters file ([`parameters.tfvars`](https://github.com/aneoconsulting/ArmoniK/blob/main/infrastructure/quick-deploy/aws/parameters.tfvars)). Check the following:

1. Open the [`parameters.tfvars`](https://github.com/aneoconsulting/ArmoniK/blob/main/infrastructure/quick-deploy/aws/parameters.tfvars) file.
2. Look for the worker_image:

```hcl
      worker = [
      {
        image = "subtasking"
        ...
```
