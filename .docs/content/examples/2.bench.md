# Bench

This is a benchmark client that submits tasks to an ArmoniK server session, optionally uploads payloads/results, waits for completion and gathers basic execution statistics.

Run the container with environment variables to configure the workload:

```bash
docker run --rm \
    -e BenchOptions__NTasks=400 \
    -e BenchOptions__TaskDurationMs=10 \
    -e BenchOptions__Partition=bench \
    -e GrpcClient__Endpoint=http://192.168.6.31:5001 \
    -e GrpcClient__Endpoint=http://<ip>:5001 \
    dockerhubaneo/armonik_core_bench_test_client:<armonik_version_core>
```

The available `BenchOptions` (env var = `BenchOptions__<Name>`) are summarized in the following table:

| Option | Type | Default | Description |
|---|---:|---:|---|
| `NTasks` | int | 100 | Number of computing tasks to submit (excluding aggregation tasks).
| `TaskDurationMs` | int | 100 | Simulated task duration in milliseconds.
| `PayloadSize` | int (KB) | 1 | Size of task payloads in kilobytes.
| `ResultSize` | int (KB) | 1 | Size of task results in kilobytes.
| `SwitchToStreamSize` | int (KB) | 10 | Threshold payload size (KB) above which the client uses streaming uploads.
| `BatchSize` | int | 100 | Number of tasks created per metadata/request batch.
| `TaskRpcException` | string | "" | If task id ends with this string, the sample task throws an RpcException (empty = disabled).
| `TaskError` | string | "" | If task id ends with this string the task completes with an error output (empty = disabled).
| `Partition` | string | "" | Partition id to use when submitting tasks.
| `ShowEvents` | bool | false | When true, subscribes to server events and logs them.
| `MaxRetries` | int | 1 | Number of retries for transient failures (used when downloading results).
| `DegreeOfParallelism` | int | 1 | Degree of parallelism for submission/download loops.
| `PurgeData` | bool | true | Whether to purge session data on Ctrl+C exit.
| `DownloadResults` | bool | true | If true, the client downloads and validates task results after completion.
| `ExitAfterSubmission` | bool | false | If true, the program exits right after tasks are submitted (no waiting).
| `PauseSessionDuringSubmission` | bool | false | If true, the session is paused while tasks are being submitted and resumed afterwards.
| `Options` | Dictionary<string,string> | {} | Additional key/value task options. Set via `BenchOptions__Options__MyKey=Value`.
| `MaxDuration` | TimeSpan | `01:00:00` | Task max duration assigned to TaskOptions (format example: `hh:mm:ss`).
| `TaskPriority` | int | 1 | Priority to use for all submitted tasks.

Note:
- `MaxDuration` is parsed as a .NET `TimeSpan` so standard `hh:mm:ss` (for example `00:30:00`).