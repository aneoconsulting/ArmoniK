# How to use HTC Mock

HTC Mock is a lightweight test client for ArmoniK that generates realistic tasks. It is used our CI/CD pipelines to validate the correct functioning of ArmoniK after code updates and development. 

Ensure the ArmoniK Core version matches the HTC Mock client version; mismatched versions may cause tests to fail. See the Default images documentation for deployment details: [the Default images page](../installation/5.default-images.md).

## Quick start

``` {warning}

HTC Mock is a development and test tool. It is not intended for production use.

```

Run the container with environment variables to configure the workload:

```bash
docker run --rm \
    -e HtcMock__NTasks=100 \
    -e HtcMock__TotalCalculationTime=00:00:00.100 \
    -e HtcMock__DataSize=1 \
    -e HtcMock__MemorySize=1 \
    -e HtcMock__EnableFastCompute=true \
    -e HtcMock__SubTasksLevels=1 \
    -e HtcMock__Partition=htcmock \
    -e GrpcClient__Endpoint=http://<ip>:5001 \
    dockerhubaneo/armonik_core_htcmock_test_client:<armonik_version_core>
```

- Replace `<ip>` with the IP or hostname of the machine where ArmoniK Core is listening.
- Replace `<armonik_version_core>` with the Core version you want to test (see the repository's `versions.tfvars.json`).

Environment variables use the `HtcMock__` prefix (see Options below); command-line arguments are also supported by the client where applicable.

## Options

Options are passed as environment variables prefixed with `HtcMock__` (or as equivalent command-line arguments). Common options:

| Name | Description | Default |
|------|-------------|---------|
| `NTasks` | Number of computing tasks to submit (some additional aggregation tasks are generated automatically). | `100` |
| `TotalCalculationTime` | Total computation time used by computing tasks (format: `hh:mm:ss.fff`). | `00:00:00.100` |
| `DataSize` | Size of each task's output (units depend on the client). | `1` |
| `MemorySize` | Simulated memory usage per task. | `1` |
| `SubTasksLevels` | Depth of sub-task levels to generate (controls task graph complexity). | `4` |
| `EnableFastCompute` | If `true`, tasks obey the time parameter and run the simulated computation. | `true` |
| `EnableUseLowMem` | If `true`, tasks respect the `MemorySize` parameter when simulating memory usage. | `true` |
| `EnableSmallOutput` | If `true`, tasks respect the `DataSize` parameter when producing outputs. | `true` |
| `TaskRpcException` | If a task id ends with this string, the task raises an RPC exception; empty to disable. | empty |
| `TaskError` | If a task id ends with this string, the task finishes with an error output; empty to disable. | empty |
| `Partition` | Partition where tasks are submitted. | empty |